<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: README
  
    &mdash; Documentation by YARD 0.9.28
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "README";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'>
<h1 id="label-Tanshuku">Tanshuku</h1>

<p>Tanshuku is a simple and small Rails engine that makes it easier to shorten URLs.</p>

<h2 id="label-Key+Features">Key Features</h2>
<ul><li>
<p>Generates a unique key for a URL.</p>
<ul><li>
<p>The uniqueness is ensured at database level.</p>
</li></ul>
</li><li>
<p>Creates no additional shortened URL record if the given URL has already been shortened.</p>
<ul><li>
<p>You can create an additional record for the same URL with using a different namespace from existing records’.</p>
</li><li>
<p>Checks its existence considering the performance.</p>
</li></ul>
</li><li>
<p>Provides a Rails controller and action for finding a shortened URL record and redirecting to its original, i.e., non-shortened, URL.</p>
<ul><li>
<p>The redirection is done with 301 HTTP status.</p>
</li></ul>
</li></ul>

<h2 id="label-Usage">Usage</h2>

<h3 id="label-1.+Mount+Tanshuku-3A-3AEngine">1. Mount <code>Tanshuku::Engine</code></h3>

<p>For example, the following code generates a routing <code>GET `/t/:key` to `Tanshuku::UrlsController#show`</code>. When your Rails app receives a request to <code>/t/abcdefghij0123456789</code>, <code>Tanshuku::UrlsController#show</code> will be called and a <code>Tanshuku::Url</code> record with a key <code>abcdefghij0123456789</code> will be found. Then the request will be redirected to the <code>Tanshuku::Url</code> record’s original URL.</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># config/routes.rb
</span><span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_routes'>routes</span><span class='period'>.</span><span class='id identifier rubyid_draw'>draw</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_mount'>mount</span> <span class='const'><span class='object_link'><a href="Tanshuku.html" title="Tanshuku (module)">Tanshuku</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Tanshuku/Engine.html" title="Tanshuku::Engine (class)">Engine</a></span></span><span class='comma'>,</span> <span class='label'>at:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/t</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
</code></pre>

<p><strong>Note</strong>: You can customize the path <code>/t</code> as you like.</p>

<h3 id="label-2.+Configure+Tanshuku+-28Optional-29">2. Configure Tanshuku (Optional)</h3>

<p><strong>Note</strong>: This step is optional.</p>

<p><strong>Note</strong>: The initializer file can be generated by <code>bin/rails generate tanshuku:install</code>. See the “<a href="#installation">Installation</a>” section for more information.</p>

<h4 id="label-config.default_url_options"><code>config.default_url_options</code></h4>

<p>Tanshuku uses configured <code>config.default_url_options</code> when generating shortened URLs.</p>

<p>Default value is <code>{}</code>.</p>

<p>The following example means that the configured host and protocol are used. Shortened URLs will be like <code>https://example.com/t/abcdefghij0123456789</code>.</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># config/initializers/tanshuku.rb
</span><span class='const'><span class='object_link'><a href="Tanshuku.html" title="Tanshuku (module)">Tanshuku</a></span></span><span class='period'>.</span><span class='id identifier rubyid_configure'><span class='object_link'><a href="Tanshuku.html#configure-class_method" title="Tanshuku.configure (method)">configure</a></span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_config'>config</span><span class='op'>|</span>
  <span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_default_url_options'>default_url_options</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='label'>host:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>example.com</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>protocol:</span> <span class='symbol'>:https</span> <span class='rbrace'>}</span>
<span class='kw'>end</span>
</code></pre>

<h4 id="label-config.exception_reporter"><code>config.exception_reporter</code></h4>

<p>If an exception occurs when shortening a URL, Tanshuku reports it with configured <code>config.exception_reporter</code> object.</p>

<p>Default value is <code>Tanshuku::Configuration::DefaultExceptionReporter</code>. It logs the exception and the original URL with <code>Rails.logger.warn</code>.</p>

<p>Value of <code>config.exception_reporter</code> should respond to <code>#call</code> with keyword arguments <code>exception:</code> and <code>original_url:</code>.</p>

<p>The following example means that an exception and a URL will be reported to <a href="https://sentry.io/">Sentry</a>.</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># config/initializers/tanshuku.rb
</span><span class='const'><span class='object_link'><a href="Tanshuku.html" title="Tanshuku (module)">Tanshuku</a></span></span><span class='period'>.</span><span class='id identifier rubyid_configure'><span class='object_link'><a href="Tanshuku.html#configure-class_method" title="Tanshuku.configure (method)">configure</a></span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_config'>config</span><span class='op'>|</span>
  <span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_exception_reporter'>exception_reporter</span> <span class='op'>=</span>
    <span class='id identifier rubyid_lambda'>lambda</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='label'>exception:</span><span class='comma'>,</span> <span class='label'>original_url:</span><span class='op'>|</span>
      <span class='const'>Sentry</span><span class='period'>.</span><span class='id identifier rubyid_capture_exception'>capture_exception</span><span class='lparen'>(</span><span class='id identifier rubyid_exception'>exception</span><span class='comma'>,</span> <span class='label'>tags:</span> <span class='lbrace'>{</span> <span class='label'>original_url:</span> <span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='rbrace'>}</span>
<span class='kw'>end</span>
</code></pre>

<h3 id="label-3.+Generate+shortened+URLs">3. Generate shortened URLs</h3>

<h4 id="label-Basic+cases">Basic cases</h4>

<p>You can generate a shortened URL with <code>Tanshuku::Url.shorten</code>. For example:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><span class='object_link'><a href="Tanshuku.html" title="Tanshuku (module)">Tanshuku</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Tanshuku/Url.html" title="Tanshuku::Url (class)">Url</a></span></span><span class='period'>.</span><span class='id identifier rubyid_shorten'><span class='object_link'><a href="Tanshuku/Url.html#shorten-class_method" title="Tanshuku::Url.shorten (method)">shorten</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>https://google.com/</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>  <span class='comment'>#=&gt; &quot;https://example.com/t/abcdefghij0123456789&quot;
</span></code></pre>

<p>href="#configdefault_url_options"></a> is used for the shortened URL.</p>

<p><strong>Note</strong>: If a <code>Tanshuku::Url</code> record for the given URL already exists, no additional record will be created and always the existing record is used.</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># When no record exists for &quot;https://google.com/&quot;, a new record will be created.
</span><span class='const'><span class='object_link'><a href="Tanshuku.html" title="Tanshuku (module)">Tanshuku</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Tanshuku/Url.html" title="Tanshuku::Url (class)">Url</a></span></span><span class='period'>.</span><span class='id identifier rubyid_shorten'><span class='object_link'><a href="Tanshuku/Url.html#shorten-class_method" title="Tanshuku::Url.shorten (method)">shorten</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>https://google.com/</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>  <span class='comment'>#=&gt; &quot;https://example.com/t/abcde0123456789fghij&quot;
</span>
<span class='comment'># When a record already exists for &quot;https://google.com/&quot;, no additional record will be created.
</span><span class='const'><span class='object_link'><a href="Tanshuku.html" title="Tanshuku (module)">Tanshuku</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Tanshuku/Url.html" title="Tanshuku::Url (class)">Url</a></span></span><span class='period'>.</span><span class='id identifier rubyid_shorten'><span class='object_link'><a href="Tanshuku/Url.html#shorten-class_method" title="Tanshuku::Url.shorten (method)">shorten</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>https://google.com/</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>  <span class='comment'>#=&gt; &quot;https://example.com/t/abcde0123456789fghij&quot;
</span><span class='const'><span class='object_link'><a href="Tanshuku.html" title="Tanshuku (module)">Tanshuku</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Tanshuku/Url.html" title="Tanshuku::Url (class)">Url</a></span></span><span class='period'>.</span><span class='id identifier rubyid_shorten'><span class='object_link'><a href="Tanshuku/Url.html#shorten-class_method" title="Tanshuku::Url.shorten (method)">shorten</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>https://google.com/</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>  <span class='comment'>#=&gt; &quot;https://example.com/t/abcde0123456789fghij&quot;
</span><span class='const'><span class='object_link'><a href="Tanshuku.html" title="Tanshuku (module)">Tanshuku</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Tanshuku/Url.html" title="Tanshuku::Url (class)">Url</a></span></span><span class='period'>.</span><span class='id identifier rubyid_shorten'><span class='object_link'><a href="Tanshuku/Url.html#shorten-class_method" title="Tanshuku::Url.shorten (method)">shorten</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>https://google.com/</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>  <span class='comment'>#=&gt; &quot;https://example.com/t/abcde0123456789fghij&quot;
</span></code></pre>

<h4 id="label-Shortening+a+URL+with+ad+hoc+URL+options">Shortening a URL with ad hoc URL options</h4>

<p>You can specify URL options to <code>Tanshuku::Url.shorten</code>. For example:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><span class='object_link'><a href="Tanshuku.html" title="Tanshuku (module)">Tanshuku</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Tanshuku/Url.html" title="Tanshuku::Url (class)">Url</a></span></span><span class='period'>.</span><span class='id identifier rubyid_shorten'><span class='object_link'><a href="Tanshuku/Url.html#shorten-class_method" title="Tanshuku::Url.shorten (method)">shorten</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>https://google.com/</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>url_options:</span> <span class='lbrace'>{</span> <span class='label'>host:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>verycool.example.com</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span><span class='rparen'>)</span>
<span class='comment'>#=&gt; &quot;https://verycool.example.com/t/0123456789abcdefghij&quot;
</span>
<span class='const'><span class='object_link'><a href="Tanshuku.html" title="Tanshuku (module)">Tanshuku</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Tanshuku/Url.html" title="Tanshuku::Url (class)">Url</a></span></span><span class='period'>.</span><span class='id identifier rubyid_shorten'><span class='object_link'><a href="Tanshuku/Url.html#shorten-class_method" title="Tanshuku::Url.shorten (method)">shorten</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>https://google.com/</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>url_options:</span> <span class='lbrace'>{</span> <span class='label'>protocol:</span> <span class='symbol'>:http</span> <span class='rbrace'>}</span><span class='rparen'>)</span>
<span class='comment'>#=&gt; &quot;http://example.com/t/abcde01234fghij56789&quot;
</span></code></pre>

<h4 id="label-Shortening+a+URL+with+a+namespace">Shortening a URL with a namespace</h4>

<p>You can create additional records for the same URL with specifying a namespace.</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># When no record exists for &quot;https://google.com/&quot;, a new record will be created.
</span><span class='const'><span class='object_link'><a href="Tanshuku.html" title="Tanshuku (module)">Tanshuku</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Tanshuku/Url.html" title="Tanshuku::Url (class)">Url</a></span></span><span class='period'>.</span><span class='id identifier rubyid_shorten'><span class='object_link'><a href="Tanshuku/Url.html#shorten-class_method" title="Tanshuku::Url.shorten (method)">shorten</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>https://google.com/</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>  <span class='comment'>#=&gt; &quot;https://example.com/t/abc012def345ghi678j9&quot;
</span>
<span class='comment'># Even when a record already exists for &quot;https://google.com/&quot;, an additional record will be created if namespace is
</span><span class='comment'># specified.
</span><span class='const'><span class='object_link'><a href="Tanshuku.html" title="Tanshuku (module)">Tanshuku</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Tanshuku/Url.html" title="Tanshuku::Url (class)">Url</a></span></span><span class='period'>.</span><span class='id identifier rubyid_shorten'><span class='object_link'><a href="Tanshuku/Url.html#shorten-class_method" title="Tanshuku::Url.shorten (method)">shorten</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>https://google.com/</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>namespace:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>a</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>  <span class='comment'>#=&gt; &quot;https://example.com/t/ab01cd23ef45gh67ij89&quot;
</span><span class='const'><span class='object_link'><a href="Tanshuku.html" title="Tanshuku (module)">Tanshuku</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Tanshuku/Url.html" title="Tanshuku::Url (class)">Url</a></span></span><span class='period'>.</span><span class='id identifier rubyid_shorten'><span class='object_link'><a href="Tanshuku/Url.html#shorten-class_method" title="Tanshuku::Url.shorten (method)">shorten</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>https://google.com/</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>namespace:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>b</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>  <span class='comment'>#=&gt; &quot;https://example.com/t/a0b1c2d3e4f5g6h7i8j9&quot;
</span><span class='const'><span class='object_link'><a href="Tanshuku.html" title="Tanshuku (module)">Tanshuku</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Tanshuku/Url.html" title="Tanshuku::Url (class)">Url</a></span></span><span class='period'>.</span><span class='id identifier rubyid_shorten'><span class='object_link'><a href="Tanshuku/Url.html#shorten-class_method" title="Tanshuku::Url.shorten (method)">shorten</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>https://google.com/</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>namespace:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>c</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>  <span class='comment'>#=&gt; &quot;https://example.com/t/abcd0123efgh4567ij89&quot;
</span>
<span class='comment'># When the same URL and the same namespace is specified, no additional record will be created.
</span><span class='const'><span class='object_link'><a href="Tanshuku.html" title="Tanshuku (module)">Tanshuku</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Tanshuku/Url.html" title="Tanshuku::Url (class)">Url</a></span></span><span class='period'>.</span><span class='id identifier rubyid_shorten'><span class='object_link'><a href="Tanshuku/Url.html#shorten-class_method" title="Tanshuku::Url.shorten (method)">shorten</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>https://google.com/</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>namespace:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>a</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>  <span class='comment'>#=&gt; &quot;https://example.com/t/ab01cd23ef45gh67ij89&quot;
</span><span class='const'><span class='object_link'><a href="Tanshuku.html" title="Tanshuku (module)">Tanshuku</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Tanshuku/Url.html" title="Tanshuku::Url (class)">Url</a></span></span><span class='period'>.</span><span class='id identifier rubyid_shorten'><span class='object_link'><a href="Tanshuku/Url.html#shorten-class_method" title="Tanshuku::Url.shorten (method)">shorten</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>https://google.com/</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>namespace:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>a</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>  <span class='comment'>#=&gt; &quot;https://example.com/t/ab01cd23ef45gh67ij89&quot;
</span></code></pre>

<h4 id="label-More+information">More information</h4>

<p><a href="https://www.rubydoc.info/gems/tanshuku/Tanshuku/Url#shorten-class_method">www.rubydoc.info/gems/tanshuku/Tanshuku/Url#shorten-class_method</a></p>

<h3 id="label-4.+Share+the+shortened+URLs">4. Share the shortened URLs</h3>

<p>You can share the shortened URLs, e.g., <code>https://example.com/t/abcdefghij0123456789</code>.</p>

<p>When a user clicks a link with a shortened URL, your Rails app redirects the user to its original URL.</p>

<h2 id="label-Installation">Installation</h2>

<h3 id="label-1.+Enable+Tanshuku">1. Enable Tanshuku</h3>

<p>Add <code>gem &quot;tanshuku&quot;</code> to your application’s <code>Gemfile</code>.</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># Gemfile
</span><span class='id identifier rubyid_gem'>gem</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>tanshuku</span><span class='tstring_end'>&quot;</span></span>
</code></pre>

<h3 id="label-2.+Generate+setup+files">2. Generate setup files</h3>

<p>Execute a shell command as following:</p>

<pre class="code ruby"><code class="ruby">bin/rails generate tanshuku:install
</code></pre>

<h3 id="label-3.+Apply+generated+migration+files">3. Apply generated migration files</h3>

<p>Execute a shell command as following:</p>

<pre class="code ruby"><code class="ruby">bin/rails db:migrate
</code></pre>

<h2 id="label-Q-26A">Q&amp;A</h2>

<h3 id="label-What+does+-22tanshuku-22+mean-3F">What does “tanshuku” mean?</h3>

<p>“Tanshuku” is a Japanese word “短縮.” It means “shortening.” “短縮URL” in Japanese means “shortened URL” in English.</p>

<h3 id="label-2A-2A+-28anything+you+want-29+isn-27t+implemented-3F">** (anything you want) isn’t implemented?</h3>

<p>Does Tanshuku have some missing features? Please <a href="https://github.com/kg8m/tanshuku/issues/new">create an issue</a>.</p>
</div></div>

      <div id="footer">
  Generated on Thu Mar 23 01:58:46 2023 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.28 (ruby-3.2.1).
</div>

    </div>
  </body>
</html>